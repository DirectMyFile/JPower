subprojects {
    sourceSets {
        integTest {
            compileClasspath += main.output + test.output
            runtimeClasspath += main.output + test.output
        }
    }

    task integTest(type: Test) {
        group = "verification"
        description = "Runs the integration tests."
        testClassesDir = sourceSets.integTest.output.classesDir
        classpath = sourceSets.integTest.runtimeClasspath
        onlyIf { file("src/integTest/java/").exists() }
    }

    integTest.dependsOn test
    test.finalizedBy integTest
}
