def sysenv = System.getenv()

def ciType = ({
    if ("JENKINS_URL" in sysenv.keySet()) {
        "Jenkins"
    } else if ("TRAVIS_BUILD_NUMBER" in sysenv.keySet()) {
        "Travis CI"
    } else {
        "Unknown"
    }
})()

task ci {
    group = "build"
    description = "Executes a Build for Continuous Integration"

    for (prj in subprojects) {
        finalizedBy ":${prj.name}:test", ":${prj.name}:jar"
        if (!(ciType in ["Travis CI", "Unknown"]))
            finalizedBy ":${prj.name}:publish"
    }

    finalizedBy "jarAll", "javadocAll", "allTestsReport"

    doFirst {
        if (ciType == "Unknown") {
            logger.lifecycle "[CI Build] Cannot detect CI Type"
        }
    }
}

