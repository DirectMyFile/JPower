def sysenv = System.getenv()

ext.ciType = ({
    if ("JENKINS_URL" in sysenv.keySet()) {
        "Jenkins"
    } else if ("TRAVIS_BUILD_NUMBER" in sysenv.keySet()) {
        "Travis CI"
    } else if ("TEAMCITY_VERSION" in sysenv.keySet()) {
        "TeamCity"
    } else {
        "Unknown"
    }
})()

task ci {
    group = "build"
    description = "Executes a Build for Continuous Integration"

    finalizedBy "allTests"

    for (prj in subprojects) {
        finalizedBy ":${prj.name}:jar"
        if (ciType == "TeamCity")
            finalizedBy ":${prj.name}:publish"
    }

    finalizedBy "jarAll", "javadocAll", "dependencyReport", "htmlDependencyReport", "jpowerInfo"

    doFirst {
        if (ciType == "Unknown") {
            logger.lifecycle "[CI Build] Cannot detect CI Type"
        }
    }
}

